<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MO Receiver - Data Penimbangan</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f3f4f6;
      color: #1f2937;
      line-height: 1.6;
    }

    #root {
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background-color: #ffffff;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      margin-bottom: 24px;
    }

    .header h1 {
      font-size: 28px;
      font-weight: bold;
      color: #1f2937;
      margin-bottom: 8px;
    }

    .header p {
      color: #6b7280;
      font-size: 14px;
    }

    .card {
      background-color: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    thead {
      background-color: #f3f4f6;
    }

    th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: #1f2937;
      border-bottom: 2px solid #e5e7eb;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #f3f4f6;
      color: #1f2937;
    }

    tbody tr:hover {
      background-color: #f9fafb;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .btn-primary {
      background-color: #3b82f6;
      color: #ffffff;
      border: 1px solid #3b82f6;
    }

    .btn-primary:hover {
      background-color: #2563eb;
    }

    .btn-secondary {
      background-color: #ffffff;
      color: #374151;
      border: 1px solid #d1d5db;
    }

    .btn-secondary:hover {
      background-color: #f9fafb;
    }

    .btn-danger {
      background-color: #ef4444;
      color: #ffffff;
      border: 1px solid #ef4444;
    }

    .btn-danger:hover {
      background-color: #dc2626;
    }

    .status-badge {
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
    }

    .status-completed {
      background-color: #10b981;
      color: #ffffff;
    }

    .status-in_progress {
      background-color: #f59e0b;
      color: #ffffff;
    }

    .status-pending {
      background-color: #95a5a6;
      color: #ffffff;
    }

    .status-reject {
      background-color: #c0392b;
      color: #ffffff;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #6b7280;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #9ca3af;
    }

    .error {
      background-color: #fee2e2;
      border: 1px solid #fca5a5;
      border-radius: 8px;
      padding: 16px;
      color: #991b1b;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Import the WeighingReceiverDetail component logic
    const WeighingReceiverDetail = ({ dataId, onBack }) => {
      const [data, setData] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        fetchData();
      }, [dataId]);

      const fetchData = async () => {
        try {
          setLoading(true);
          const response = await fetch(`/api/mo-receiver/${dataId}`);
          const result = await response.json();
          
          if (result.success) {
            setData(result.data);
          } else {
            console.error('Failed to fetch data:', result.error);
          }
        } catch (error) {
          console.error('Error fetching data:', error);
        } finally {
          setLoading(false);
        }
      };

      const formatDate = (dateString) => {
        if (!dateString) return '-';
        try {
          const date = new Date(dateString);
          if (isNaN(date.getTime())) return '-';
          return date.toLocaleString('id-ID', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
          });
        } catch (e) {
          return '-';
        }
      };

      const handlePrint = () => {
        const printWindow = window.open('', '_blank');
        
        if (!printWindow) {
          alert('Pop-up blocker mencegah pembukaan jendela print. Tolong izinkan pop-up untuk halaman ini.');
          return;
        }

        const { workOrder, ingredients } = data;

        // Get summary totals
        const summaryTotals = ingredients && ingredients.length > 0
          ? ingredients.reduce((acc, ingredient) => {
              const scaledWeight = parseFloat(ingredient.target_mass || 0) || 0;
              let totalWeight = 0;
              if (ingredient.exp_dates && ingredient.exp_dates.length > 0) {
                totalWeight = ingredient.exp_dates.reduce((sum, expData) => {
                  const weight = typeof expData === 'object' && expData.actual_weight !== undefined
                    ? parseFloat(expData.actual_weight || 0)
                    : 0;
                  return sum + weight;
                }, 0);
              } else {
                totalWeight = parseFloat(ingredient.current_accumulated_mass || 0) || 0;
              }
              acc.scaled += scaledWeight;
              acc.actual += totalWeight;
              return acc;
            }, { scaled: 0, actual: 0 })
          : null;

        const totalResolution = summaryTotals ? summaryTotals.actual - summaryTotals.scaled : 0;

        // Build table rows
        const tableRows = ingredients && ingredients.length > 0
          ? ingredients.flatMap((ingredient, idx) => {
              const scaledWeight = parseFloat(ingredient.target_mass || 0);
              const minWeight = ingredient.tolerance_min !== null && ingredient.tolerance_min !== undefined
                ? parseFloat(ingredient.tolerance_min || 0)
                : null;
              const maxWeight = ingredient.tolerance_max !== null && ingredient.tolerance_max !== undefined
                ? parseFloat(ingredient.tolerance_max || 0)
                : null;
              
              let expDatesData = [];
              if (ingredient.exp_dates && ingredient.exp_dates.length > 0) {
                expDatesData = ingredient.exp_dates;
              } else {
                const totalMass = parseFloat(ingredient.current_accumulated_mass || 0);
                expDatesData = [{
                  exp_date: '-',
                  actual_weight: totalMass
                }];
              }
              
              const totalWeight = expDatesData.reduce((sum, expData) => {
                const weight = typeof expData === 'object' && expData.actual_weight !== undefined
                  ? parseFloat(expData.actual_weight || 0)
                  : 0;
                return sum + weight;
              }, 0);
              
              const resolution = totalWeight - scaledWeight;
              
              return expDatesData.map((expData, expIdx) => {
                const expDate = typeof expData === 'string' ? expData : expData.exp_date;
                const actualWeight = typeof expData === 'object' && expData.actual_weight !== undefined
                  ? parseFloat(expData.actual_weight || 0)
                  : (expIdx === 0 ? parseFloat(ingredient.current_accumulated_mass || 0) : 0);
                
                return `
                  <tr>
                    <td style="padding: 8px; border-bottom: 1px solid #e5e7eb;">${expIdx === 0 ? (ingredient.ingredient_name || '-') : ''}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e5e7eb; color: #6b7280;">${expIdx === 0 ? (ingredient.ingredient_code || '-') : ''}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: left;">${expDate}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: right; color: #6b7280;">${expIdx === 0 ? (minWeight !== null ? minWeight.toFixed(2) : '-') : ''}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: right;">${expIdx === 0 ? scaledWeight.toFixed(2) : ''}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: right; color: #6b7280;">${expIdx === 0 ? (maxWeight !== null ? maxWeight.toFixed(2) : '-') : ''}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: right; color: #059669; font-weight: 600;">${actualWeight > 0 ? actualWeight.toFixed(2) : ''}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: right; color: #059669; font-weight: 600;">${expIdx === 0 ? totalWeight.toFixed(2) : ''}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: right; color: ${resolution >= 0 ? '#059669' : '#dc2626'}; font-weight: 600;">${expIdx === 0 ? (resolution >= 0 ? '+' : '') + resolution.toFixed(2) : ''}</td>
                  </tr>
                `;
              });
            }).join('')
          : '<tr><td colspan="9" style="padding: 20px; text-align: center; color: #9ca3af;">Tidak ada data ingredients</td></tr>';

        const totalRow = summaryTotals ? `
          <tr style="background-color: #f9fafb; border-top: 2px solid #d1d5db;">
            <td colspan="2" style="padding: 12px; font-weight: 700; color: #1f2937;">Total</td>
            <td style="padding: 12px; text-align: left; font-weight: 700; color: #1f2937;"></td>
            <td style="padding: 12px; text-align: right; font-weight: 700; color: #1f2937;"></td>
            <td style="padding: 12px; text-align: right; font-weight: 700; color: #1f2937;">${summaryTotals.scaled.toFixed(2)}</td>
            <td style="padding: 12px; text-align: right; font-weight: 700; color: #1f2937;"></td>
            <td style="padding: 12px; text-align: right; font-weight: 700; color: #059669;">${summaryTotals.actual.toFixed(2)}</td>
            <td style="padding: 12px; text-align: right; font-weight: 700; color: #059669;">${summaryTotals.actual.toFixed(2)}</td>
            <td style="padding: 12px; text-align: right; font-weight: 700; color: ${totalResolution >= 0 ? '#059669' : '#dc2626'};">
              ${totalResolution >= 0 ? '+' : ''}${totalResolution.toFixed(2)}
            </td>
          </tr>
        ` : '';

        const printHTML = `
          <!DOCTYPE html>
          <html>
            <head>
              <meta charset="UTF-8">
              <title>Report Summary Penimbangan - ${workOrder.work_order}</title>
              <style>
                @page { size: A4; margin: 15mm 10mm; }
                * { margin: 0; padding: 0; box-sizing: border-box; }
                body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 11pt; color: #1f2937; line-height: 1.4; }
                .print-header { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #1f2937; }
                .print-title { font-size: 18pt; font-weight: bold; color: #1f2937; margin-bottom: 10px; }
                .print-info { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 15px; padding: 12px; background-color: #f9fafb; border-radius: 6px; border: 1px solid #e5e7eb; }
                .print-info-label { font-size: 9pt; color: #6b7280; margin-bottom: 4px; font-weight: 500; }
                .print-info-value { font-size: 12pt; font-weight: 600; color: #1f2937; }
                .print-table { width: 100%; border-collapse: collapse; font-size: 10pt; margin-top: 20px; }
                .print-table thead { background-color: #f3f4f6; }
                .print-table thead th { padding: 10px 8px; text-align: left; font-weight: 600; color: #1f2937; border-bottom: 2px solid #d1d5db; }
                .print-footer { margin-top: 30px; padding-top: 15px; border-top: 1px solid #e5e7eb; font-size: 9pt; color: #9ca3af; text-align: center; }
                @media print { body { print-color-adjust: exact; -webkit-print-color-adjust: exact; } }
              </style>
            </head>
            <body>
              <div class="print-header">
                <div class="print-title">Report Summary Penimbangan</div>
                <div class="print-info">
                  <div><div class="print-info-label">Nomor MO</div><div class="print-info-value">${workOrder.work_order}</div></div>
                  <div><div class="print-info-label">Nama SKU</div><div class="print-info-value">${workOrder.sku || '-'}</div></div>
                  <div><div class="print-info-label">QTY</div><div class="print-info-value">${parseFloat(workOrder.planned_quantity || 0).toFixed(1)} g</div></div>
                </div>
                <div style="margin-top: 10px; font-size: 9pt; color: #6b7280;">
                  <div><strong>Formula:</strong> ${workOrder.formulation_name || '-'}</div>
                  <div style="margin-top: 4px;"><strong>Tanggal Produksi:</strong> ${formatDate(workOrder.production_date)}</div>
                  ${workOrder.operator_name ? `<div style="margin-top: 4px;"><strong>Operator:</strong> ${workOrder.operator_name}</div>` : ''}
                  ${workOrder.end_time ? `<div style="margin-top: 4px;"><strong>Tanggal Selesai:</strong> ${formatDate(workOrder.end_time)}</div>` : ''}
                </div>
              </div>
              <table class="print-table">
                <thead>
                  <tr>
                    <th>Nama Ingredients</th>
                    <th>Kode Ingredients</th>
                    <th>Exp Date</th>
                    <th>Min Weight (g)</th>
                    <th>Scaled Weight (g)</th>
                    <th>Max Weight (g)</th>
                    <th>Actual Weight (g)</th>
                    <th>Total Weight (g)</th>
                    <th>Resolution (g)</th>
                  </tr>
                </thead>
                <tbody>${tableRows}</tbody>
                <tfoot>${totalRow}</tfoot>
              </table>
              <div class="print-footer">
                <div>Laporan ini dicetak pada: ${new Date().toLocaleString('id-ID')}</div>
                <div style="margin-top: 4px;">Work Order: ${workOrder.work_order}</div>
              </div>
            </body>
          </html>
        `;

        printWindow.document.write(printHTML);
        printWindow.document.close();
        printWindow.onload = () => {
          setTimeout(() => {
            printWindow.print();
          }, 250);
        };
      };

      if (loading) {
        return (
          <div className="loading">
            <div>Memuat data...</div>
          </div>
        );
      }

      if (!data) {
        return (
          <div className="empty-state">
            <div>Data tidak ditemukan</div>
            <button onClick={onBack} className="btn btn-secondary" style={{ marginTop: '20px' }}>
              Kembali
            </button>
          </div>
        );
      }

      const { workOrder, ingredients } = data;

      const summaryTotals = ingredients && ingredients.length > 0
        ? ingredients.reduce((acc, ingredient) => {
            const scaledWeight = parseFloat(ingredient.target_mass || 0) || 0;
            let totalWeight = 0;
            if (ingredient.exp_dates && ingredient.exp_dates.length > 0) {
              totalWeight = ingredient.exp_dates.reduce((sum, expData) => {
                const weight = typeof expData === 'object' && expData.actual_weight !== undefined
                  ? parseFloat(expData.actual_weight || 0)
                  : 0;
                return sum + weight;
              }, 0);
            } else {
              totalWeight = parseFloat(ingredient.current_accumulated_mass || 0) || 0;
            }
            acc.scaled += scaledWeight;
            acc.actual += totalWeight;
            return acc;
          }, { scaled: 0, actual: 0 })
        : null;

      const totalResolution = summaryTotals ? summaryTotals.actual - summaryTotals.scaled : 0;

      return (
        <div className="container">
          <div className="card">
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px', paddingBottom: '16px', borderBottom: '2px solid #e5e7eb' }}>
              <button onClick={onBack} className="btn btn-secondary">
                ‚Üê Kembali
              </button>
              <button onClick={handlePrint} className="btn btn-primary">
                üñ®Ô∏è Print
              </button>
            </div>

            {/* Work Order Header */}
            <div style={{ marginBottom: '24px' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '16px' }}>
                <div>
                  <h1 style={{ fontSize: '28px', fontWeight: 'bold', marginBottom: '8px' }}>{workOrder.work_order}</h1>
                  <div style={{ fontSize: '18px', color: '#6b7280', marginBottom: '4px' }}>{workOrder.formulation_name}</div>
                  <div style={{ fontSize: '14px', color: '#9ca3af' }}>SKU: {workOrder.sku}</div>
                </div>
                <span className={`status-badge status-${workOrder.status}`}>
                  {workOrder.status === 'completed' ? 'Selesai' : 
                   workOrder.status === 'reject' ? 'Ditolak' :
                   workOrder.status === 'in_progress' ? 'Sedang Berjalan' : 'Pending'}
                </span>
              </div>

              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px', marginTop: '16px', paddingTop: '16px', borderTop: '1px solid #e5e7eb' }}>
                <div>
                  <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>Tanggal Produksi</div>
                  <div style={{ fontSize: '14px', fontWeight: '600' }}>{formatDate(workOrder.production_date)}</div>
                </div>
                <div>
                  <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>Planned Quantity</div>
                  <div style={{ fontSize: '14px', fontWeight: '600' }}>{parseFloat(workOrder.planned_quantity || 0).toFixed(1)} g</div>
                </div>
                <div>
                  <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>Operator</div>
                  <div style={{ fontSize: '14px', fontWeight: '600' }}>{workOrder.operator_name || 'Unknown'}</div>
                </div>
                {workOrder.end_time && (
                  <div>
                    <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>Tanggal Selesai</div>
                    <div style={{ fontSize: '14px', fontWeight: '600' }}>{formatDate(workOrder.end_time)}</div>
                  </div>
                )}
              </div>
            </div>

            {/* Report Summary */}
            <h2 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '16px' }}>Report Summary Penimbangan</h2>

            <div className="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Nama Ingredients</th>
                    <th>Kode Ingredients</th>
                    <th>Exp Date</th>
                    <th style={{ textAlign: 'right' }}>Min Weight (g)</th>
                    <th style={{ textAlign: 'right' }}>Scaled Weight (g)</th>
                    <th style={{ textAlign: 'right' }}>Max Weight (g)</th>
                    <th style={{ textAlign: 'right' }}>Actual Weight (g)</th>
                    <th style={{ textAlign: 'right' }}>Total Weight (g)</th>
                    <th style={{ textAlign: 'right' }}>Resolution (g)</th>
                  </tr>
                </thead>
                <tbody>
                  {ingredients && ingredients.length > 0 ? (
                    ingredients.flatMap((ingredient, idx) => {
                      const scaledWeight = parseFloat(ingredient.target_mass || 0);
                      const minWeight = ingredient.tolerance_min !== null && ingredient.tolerance_min !== undefined
                        ? parseFloat(ingredient.tolerance_min || 0)
                        : null;
                      const maxWeight = ingredient.tolerance_max !== null && ingredient.tolerance_max !== undefined
                        ? parseFloat(ingredient.tolerance_max || 0)
                        : null;
                      
                      let expDatesData = [];
                      if (ingredient.exp_dates && ingredient.exp_dates.length > 0) {
                        expDatesData = ingredient.exp_dates;
                      } else {
                        const totalMass = parseFloat(ingredient.current_accumulated_mass || 0);
                        expDatesData = [{
                          exp_date: '-',
                          actual_weight: totalMass
                        }];
                      }
                      
                      const totalWeight = expDatesData.reduce((sum, expData) => {
                        const weight = typeof expData === 'object' && expData.actual_weight !== undefined
                          ? parseFloat(expData.actual_weight || 0)
                          : 0;
                        return sum + weight;
                      }, 0);
                      
                      const resolution = totalWeight - scaledWeight;
                      
                      return expDatesData.map((expData, expIdx) => {
                        const expDate = typeof expData === 'string' ? expData : expData.exp_date;
                        const actualWeight = typeof expData === 'object' && expData.actual_weight !== undefined
                          ? parseFloat(expData.actual_weight || 0)
                          : (expIdx === 0 ? parseFloat(ingredient.current_accumulated_mass || 0) : 0);
                        
                        return (
                          <tr key={`${ingredient.ingredient_id || idx}-${expIdx}`}>
                            <td>{expIdx === 0 ? (ingredient.ingredient_name || '-') : ''}</td>
                            <td style={{ color: '#6b7280' }}>{expIdx === 0 ? (ingredient.ingredient_code || '-') : ''}</td>
                            <td>{expDate}</td>
                            <td style={{ textAlign: 'right', color: '#6b7280' }}>{expIdx === 0 ? (minWeight !== null ? minWeight.toFixed(2) : '-') : ''}</td>
                            <td style={{ textAlign: 'right' }}>{expIdx === 0 ? scaledWeight.toFixed(2) : ''}</td>
                            <td style={{ textAlign: 'right', color: '#6b7280' }}>{expIdx === 0 ? (maxWeight !== null ? maxWeight.toFixed(2) : '-') : ''}</td>
                            <td style={{ textAlign: 'right', color: '#059669', fontWeight: '600' }}>{actualWeight > 0 ? actualWeight.toFixed(2) : ''}</td>
                            <td style={{ textAlign: 'right', color: '#059669', fontWeight: '600' }}>{expIdx === 0 ? totalWeight.toFixed(2) : ''}</td>
                            <td style={{ textAlign: 'right', color: resolution >= 0 ? '#059669' : '#dc2626', fontWeight: '600' }}>
                              {expIdx === 0 ? (resolution >= 0 ? '+' : '') + resolution.toFixed(2) : ''}
                            </td>
                          </tr>
                        );
                      });
                    })
                  ) : (
                    <tr>
                      <td colSpan="9" className="empty-state">Tidak ada data ingredients</td>
                    </tr>
                  )}
                  {summaryTotals && (
                    <tr style={{ backgroundColor: '#f9fafb', borderTop: '2px solid #d1d5db', fontWeight: '700' }}>
                      <td colSpan="2">Total</td>
                      <td></td>
                      <td style={{ textAlign: 'right' }}></td>
                      <td style={{ textAlign: 'right' }}>{summaryTotals.scaled.toFixed(2)}</td>
                      <td style={{ textAlign: 'right' }}></td>
                      <td style={{ textAlign: 'right', color: '#059669' }}>{summaryTotals.actual.toFixed(2)}</td>
                      <td style={{ textAlign: 'right', color: '#059669' }}>{summaryTotals.actual.toFixed(2)}</td>
                      <td style={{ textAlign: 'right', color: totalResolution >= 0 ? '#059669' : '#dc2626' }}>
                        {totalResolution >= 0 ? '+' : ''}{totalResolution.toFixed(2)}
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      );
    };

    // Main App Component
    const App = () => {
      const [moList, setMoList] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [selectedMoId, setSelectedMoId] = useState(null);
      const [refreshKey, setRefreshKey] = useState(0);

      useEffect(() => {
        fetchMoList();
      }, [refreshKey]);

      const fetchMoList = async () => {
        try {
          setLoading(true);
          setError(null);
          const response = await fetch('/api/mo-list');
          const result = await response.json();
          
          if (result.success) {
            setMoList(result.data);
          } else {
            setError('Gagal memuat data: ' + result.error);
          }
        } catch (err) {
          setError('Error: ' + err.message);
        } finally {
          setLoading(false);
        }
      };

      const handleDelete = async (id, workOrder) => {
        if (!confirm(`Apakah Anda yakin ingin menghapus data MO ${workOrder}?`)) {
          return;
        }

        try {
          const response = await fetch(`/api/mo-receiver/${id}`, {
            method: 'DELETE'
          });
          const result = await response.json();
          
          if (result.success) {
            alert('Data berhasil dihapus');
            setRefreshKey(prev => prev + 1);
          } else {
            alert('Gagal menghapus data: ' + result.error);
          }
        } catch (err) {
          alert('Error: ' + err.message);
        }
      };

      const formatDate = (dateString) => {
        if (!dateString) return '-';
        try {
          const date = new Date(dateString);
          if (isNaN(date.getTime())) return '-';
          return date.toLocaleString('id-ID', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
        } catch (e) {
          return '-';
        }
      };

      // If viewing detail, show detail component
      if (selectedMoId) {
        return (
          <WeighingReceiverDetail 
            dataId={selectedMoId} 
            onBack={() => setSelectedMoId(null)} 
          />
        );
      }

      // Otherwise, show list
      return (
        <div className="container">
          <div className="header">
            <h1>üìä MO Receiver - Data Penimbangan</h1>
            <p>Sistem penerima dan penampil data Manufacturing Order dari website eksternal</p>
          </div>

          {error && (
            <div className="error">
              <strong>Error:</strong> {error}
            </div>
          )}

          <div className="card">
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
              <h2 style={{ fontSize: '20px', fontWeight: '600' }}>Daftar Manufacturing Order</h2>
              <button onClick={() => setRefreshKey(prev => prev + 1)} className="btn btn-secondary">
                üîÑ Refresh
              </button>
            </div>

            {loading ? (
              <div className="loading">Memuat data...</div>
            ) : moList.length === 0 ? (
              <div className="empty-state">
                <p>Belum ada data MO yang diterima.</p>
                <p style={{ marginTop: '8px', fontSize: '14px' }}>Data akan muncul di sini setelah diterima melalui API endpoint.</p>
              </div>
            ) : (
              <div className="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>No</th>
                      <th>Nomor MO</th>
                      <th>Nama SKU</th>
                      <th>Formula</th>
                      <th>Status</th>
                      <th>Tanggal Update</th>
                      <th style={{ textAlign: 'center' }}>Aksi</th>
                    </tr>
                  </thead>
                  <tbody>
                    {moList.map((mo, index) => (
                      <tr key={mo.id}>
                        <td>{index + 1}</td>
                        <td style={{ fontWeight: '600' }}>{mo.work_order}</td>
                        <td>{mo.sku || '-'}</td>
                        <td>{mo.formulation_name || '-'}</td>
                        <td>
                          <span className={`status-badge status-${mo.status}`}>
                            {mo.status === 'completed' ? 'Selesai' : 
                             mo.status === 'reject' ? 'Ditolak' :
                             mo.status === 'in_progress' ? 'Sedang Berjalan' : 'Pending'}
                          </span>
                        </td>
                        <td>{formatDate(mo.updated_at)}</td>
                        <td style={{ textAlign: 'center' }}>
                          <div style={{ display: 'flex', gap: '8px', justifyContent: 'center' }}>
                            <button 
                              onClick={() => setSelectedMoId(mo.id)}
                              className="btn btn-primary"
                            >
                              üìÑ View Report
                            </button>
                            <button 
                              onClick={() => handleDelete(mo.id, mo.work_order)}
                              className="btn btn-danger"
                            >
                              üóëÔ∏è
                            </button>
                          </div>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>

          {/* API Information */}
          <div className="card" style={{ marginTop: '24px', backgroundColor: '#f9fafb' }}>
            <h3 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '12px' }}>‚ÑπÔ∏è Informasi API Endpoint</h3>
            <div style={{ fontSize: '14px', color: '#6b7280', lineHeight: '1.8' }}>
              <p><strong>Endpoint untuk menerima data:</strong></p>
              <p style={{ marginTop: '4px', fontFamily: 'monospace', backgroundColor: '#fff', padding: '8px', borderRadius: '4px' }}>
                POST {window.location.origin}/api/mo/receive
              </p>
              <p style={{ marginTop: '12px' }}><strong>Header yang diperlukan:</strong></p>
              <p style={{ marginTop: '4px', fontFamily: 'monospace', backgroundColor: '#fff', padding: '8px', borderRadius: '4px' }}>
                Authorization: Bearer YOUR_TOKEN_HERE<br/>
                Content-Type: application/json
              </p>
            </div>
          </div>
        </div>
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>

